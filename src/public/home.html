<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PlaceGrad - Home</title>
    <style>
        body {
            margin: 0;
            font-family: 'Segoe UI', sans-serif;
            color: #fff;
            position: relative;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .tp-bgimg {
            position: fixed;
            top: 0; left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0);
            background-repeat: no-repeat;
            background-image: url('https://www.ldrp.ac.in/wp-content/uploads/LDRP-Optimized.png');
            background-size: cover;
            background-position: center center;
            z-index: -1;
        }

        .overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            z-index: -1;
        }

        .top-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
            background-color: rgba(0,0,0,0.4);
        }

        .logo-container-top {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .top-logo {
            height: 60px;
        }

        .main-nav ul {
            list-style: none;
            display: flex;
            gap: 1.5rem;
            margin: 0;
            padding: 0;
        }

        .main-nav a {
            color: #fff;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s ease;
        }

        .main-nav a:hover {
            color: #00c3ff;
        }

        .main-content {
            flex: 1;
            padding: 2rem;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .main-logo-section {
            margin-top: -1rem;
            margin-bottom: 0.2rem;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .main-logo-svg {
            width: 120px;
            height: 120px;
            filter: drop-shadow(0 2px 10px rgba(0, 0, 0, 0.3));
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            padding: 5px;
            backdrop-filter: blur(3px);
        }

        .portal-title-section {
            margin-bottom: 2rem;
        }

        .portal-title {
            font-size: 3.5rem;
            font-weight: bold;
            margin-bottom: 1rem;
            background: linear-gradient(45deg, #00c3ff, #0080ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 2px 10px rgba(0, 195, 255, 0.3);
        }

        .portal-description {
            font-size: 1.2rem;
            color: #e0e0e0;
            max-width: 600px;
            line-height: 1.6;
            margin-bottom: 2rem;
        }

        .welcome-section h2 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: #fff;
        }

        .footer-info {
            text-align: center;
            padding: 1.5rem;
            font-size: 0.9rem;
            background-color: rgba(0,0,0,0.7);
            margin-top: auto;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .footer-links {
            margin-top: 0.5rem;
        }

        .footer-link {
            color: #ccc;
            margin: 0 0.5rem;
            text-decoration: none;
        }

        .footer-link:hover {
            color: #00c3ff;
        }

        .floating-elements {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .floating-circle {
            position: absolute;
            border-radius: 50%;
            background: linear-gradient(45deg, rgba(0, 195, 255, 0.1), rgba(0, 128, 255, 0.1));
            animation: float 6s ease-in-out infinite;
        }

        .floating-circle:nth-child(1) {
            width: 80px;
            height: 80px;
            top: 20%;
            left: 10%;
            animation-delay: 0s;
        }

        .floating-circle:nth-child(2) {
            width: 120px;
            height: 120px;
            top: 60%;
            right: 15%;
            animation-delay: 2s;
        }

        .floating-circle:nth-child(3) {
            width: 60px;
            height: 60px;
            bottom: 20%;
            left: 20%;
            animation-delay: 4s;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }

        /* Enhanced Chatbot Styles */
        #chatbot-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(45deg, #0066cc, #0080ff);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 15px 20px;
            font-size: 16px;
            cursor: pointer;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(0, 102, 204, 0.3);
            transition: all 0.3s ease;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        #chatbot-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 102, 204, 0.4);
        }

        #chatbot-box {
            display: none;
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 380px;
            max-width: 90vw;
            background-color: white;
            color: black;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            overflow: hidden;
            flex-direction: column;
            font-family: 'Segoe UI', sans-serif;
            max-height: 600px;
        }

        #chatbot-header {
            background: linear-gradient(45deg, #0066cc, #0080ff);
            color: white;
            padding: 15px 20px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #chatbot-header .chatbot-controls {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        #clear-chat {
            background: none;
            border: none;
            color: #fff;
            cursor: pointer;
            padding: 4px 8px;
            font-size: 14px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: background-color 0.2s;
        }

        #clear-chat:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        #chatbot-close {
            background: none;
            border: none;
            color: #fff;
            cursor: pointer;
            padding: 4px 8px;
            font-size: 18px;
            border-radius: 4px;
            transition: background-color 0.2s;
            line-height: 1;
        }

        #chatbot-close:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        #chatbot-messages {
            height: 350px;
            overflow-y: auto;
            padding: 20px;
            font-size: 14px;
            line-height: 1.5;
            background: #f8f9fa;
        }

        .message {
            margin-bottom: 15px;
            display: flex;
            flex-direction: column;
        }

        .user-message {
            align-items: flex-end;
        }

        .bot-message {
            align-items: flex-start;
        }

        .message-bubble {
            max-width: 85%;
            padding: 12px 16px;
            border-radius: 18px;
            word-wrap: break-word;
            white-space: pre-line;
        }

        .user-message .message-bubble {
            background: linear-gradient(45deg, #0066cc, #0080ff);
            color: white;
        }

        .bot-message .message-bubble {
            background: white;
            color: #333;
            border: 1px solid #e1e5e9;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .message-time {
            font-size: 11px;
            color: #666;
            margin-top: 4px;
            align-self: flex-end;
        }

        #chatbot-input {
            display: flex;
            border-top: 1px solid #e1e5e9;
            padding: 15px 20px;
            gap: 10px;
            background: white;
        }

        #user-input {
            flex: 1;
            resize: none;
            font-size: 14px;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 25px;
            font-family: inherit;
            outline: none;
            transition: border-color 0.3s ease;
            max-height: 100px;
            min-height: 40px;
        }

        #user-input:focus {
            border-color: #0066cc;
        }

        #send-btn {
            background: linear-gradient(45deg, #0066cc, #0080ff);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            min-width: 70px;
        }

        #send-btn:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 102, 204, 0.3);
        }

        #send-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .typing-indicator {
            display: none;
            color: #666;
            font-style: italic;
            padding: 10px 16px;
            background: #f8f9fa;
        }

        .typing-indicator.show {
            display: block;
        }

        .error-message {
            background: #ffe6e6 !important;
            color: #d63031 !important;
            border: 1px solid #fab1a0 !important;
        }

        .connection-status {
            font-size: 12px;
            text-align: center;
            padding: 8px;
            background: #e8f4fd;
            border-bottom: 1px solid #e1e5e9;
            color: #0066cc;
        }

        .connection-status.offline {
            background: #fff3cd;
            color: #856404;
        }

        /* Quick Actions */
        .quick-actions {
            padding: 10px 20px;
            background: #f8f9fa;
            border-top: 1px solid #e1e5e9;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .quick-action-btn {
            background: #e9ecef;
            border: none;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 12px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .quick-action-btn:hover {
            background: #dee2e6;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .main-logo-svg {
                width: 80px;
                height: 80px;
            }
            
            .portal-title {
                font-size: 2.5rem;
            }
            
            .portal-description {
                font-size: 1rem;
                padding: 0 1rem;
            }
            
            .top-header {
                flex-direction: column;
                gap: 1rem;
            }
            
            .main-nav ul {
                justify-content: center;
            }

            #chatbot-box {
                width: 95vw;
                right: 2.5vw;
                max-height: 70vh;
            }

            #chatbot-toggle {
                bottom: 15px;
                right: 15px;
                padding: 12px 16px;
                font-size: 14px;
            }

            #chatbot-messages {
                height: 250px;
            }
        }
    </style>
</head>
<body>
    <!-- Background Image -->
    <div class="tp-bgimg"></div>
    
    <!-- Overlay -->
    <div class="overlay"></div>

    <!-- Floating Decorative Circles -->
    <div class="floating-elements">
        <div class="floating-circle"></div>
        <div class="floating-circle"></div>
        <div class="floating-circle"></div>
    </div>

    <!-- Header Section -->
    <header class="top-header">
        <div class="logo-container-top">
            <img src="https://www.ldrp.ac.in/wp-content/uploads/LDRP-logo-3.png" alt="LDRP Logo" class="top-logo">
        </div>
        <nav class="main-nav">
            <ul>
                <li><a href="dashboard.html">Dashboard</a></li>
                <li><a href="companies.html">Companies</a></li>
                <li><a href="profile.html">Profile</a></li>
                <li><a href="support.html">Support</a></li>
                <li><a href="login.html">Logout</a></li>
            </ul>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Main Logo Section -->
        <div class="main-logo-section">
            <svg width="100" height="100" viewBox="0 0 300 300" xmlns="http://www.w3.org/2000/svg" class="main-logo-svg">
                <!-- Outer Circle -->
                <circle cx="150" cy="150" r="140" stroke="#1E90FF" stroke-width="8" fill="none" />
                
                <!-- Graduation Cap Icon -->
                <text x="150" y="120" font-size="32" text-anchor="middle" dominant-baseline="middle">üéì</text>
                
                <!-- Brand Name -->
                <text x="150" y="180" font-size="28" font-family="Arial, sans-serif" font-weight="bold"
                      text-anchor="middle" fill="#2E8B57">PlaceGrad</text>
                
                <!-- Optional Tagline -->
                <text x="150" y="210" font-size="14" font-family="Arial, sans-serif"
                      text-anchor="middle" fill="#555">Your Gateway to Careers</text>
            </svg>
        </div>

        <div class="portal-title-section">
            <h1 class="portal-title">PlaceGrad</h1>
            <p class="portal-description">
                PlaceGrad is the official placement portal for LDRP Institute of Technology and Research students. Our platform connects students with career opportunities and top companies. Get access to job openings, interview preparation resources, and placement guidance. Track your placement journey with real-time updates and personalized support. Transform your academic achievements into professional success with PlaceGrad.
            </p>
        </div>
        
        <section class="welcome-section">
            <h2>Your Gateway to Career Success</h2>
            <p>Discover endless possibilities with our industry-connected placement portal.</p>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer-info">
        <div class="copyright">
            ¬© 2025 LDRP Institute of Technology and Research. All rights reserved.
        </div>
        <div class="footer-links">
            <a href="#" class="footer-link">Privacy Policy</a>
            <a href="#" class="footer-link">Terms of Service</a>
            <a href="#" class="footer-link">Support</a>
        </div>
    </footer>

    <!-- Enhanced Chatbot Button -->
    <button id="chatbot-toggle" onclick="toggleChatbot()">
        <span>üí¨</span>
        <span>Chat with Us</span>
    </button>
    
    <!-- Enhanced Chatbot Box -->
    <div id="chatbot-box">
        <div id="chatbot-header">
            <span>PlaceGrad Assistant</span>
            <div class="chatbot-controls">
                <button id="clear-chat" onclick="clearChat()" title="Clear Chat">üóëÔ∏è</button>
                <button id="chatbot-close" onclick="toggleChatbot()">&times;</button>
            </div>
        </div>
        <div class="connection-status" id="connection-status">Connected to PlaceGrad AI</div>
        <div id="chatbot-messages"></div>
        <div class="typing-indicator" id="typing-indicator">Bot is typing...</div>
        <div class="quick-actions">
            <button class="quick-action-btn" onclick="askQuickQuestion('Tell me about interview tips')">Interview Tips</button>
            <button class="quick-action-btn" onclick="askQuickQuestion('Show me company information')">Companies</button>
            <button class="quick-action-btn" onclick="askQuickQuestion('Help with resume')">Resume Help</button>
        </div>
        <div id="chatbot-input">
            <textarea id="user-input" placeholder="Ask about placements, companies, interviews..." rows="1"></textarea>
            <button id="send-btn" onclick="sendMessage()">Send</button>
        </div>
    </div>

    <script>
        // Enhanced Chatbot functionality
        let isTyping = false;
        let isOnline = true;

        function toggleChatbot() {
            const bot = document.getElementById('chatbot-box');
            const isVisible = bot.style.display === 'flex';
            bot.style.display = isVisible ? 'none' : 'flex';
            
            if (!isVisible) {
                document.getElementById('user-input').focus();
                // Load chat history when opening
                loadChatHistory();
                checkSystemHealth();
            }
        }

        function formatTime() {
            const now = new Date();
            return now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        }

        function addMessage(content, isUser = false, isError = false) {
            const messagesDiv = document.getElementById('chatbot-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user-message' : 'bot-message'}`;
            
            const bubbleDiv = document.createElement('div');
            bubbleDiv.className = `message-bubble ${isError ? 'error-message' : ''}`;
            bubbleDiv.textContent = content;
            
            const timeDiv = document.createElement('div');
            timeDiv.className = 'message-time';
            timeDiv.textContent = formatTime();
            
            messageDiv.appendChild(bubbleDiv);
            messageDiv.appendChild(timeDiv);
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function showTypingIndicator() {
            const indicator = document.getElementById('typing-indicator');
            indicator.classList.add('show');
            const messagesDiv = document.getElementById('chatbot-messages');
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function hideTypingIndicator() {
            const indicator = document.getElementById('typing-indicator');
            indicator.classList.remove('show');
        }

        function updateConnectionStatus(online = true) {
            const statusDiv = document.getElementById('connection-status');
            isOnline = online;
            
            if (online) {
                statusDiv.textContent = 'Connected to PlaceGrad AI';
                statusDiv.className = 'connection-status';
            } else {
                statusDiv.textContent = 'Using offline mode';
                statusDiv.className = 'connection-status offline';
            }
        }

        async function sendMessage() {
            const input = document.getElementById('user-input');
            const sendBtn = document.getElementById('send-btn');
            const message = input.value.trim();

            if (!message || isTyping) return;

            // Disable input and show user message
            isTyping = true;
            sendBtn.disabled = true;
            addMessage(message, true);
            input.value = '';
            input.style.height = 'auto';

            // Show typing indicator
            showTypingIndicator();

            try {
                // Try Flask backend first
                const response = await fetch('/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ message: message }),
                    timeout: 10000
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                
                // Hide typing indicator and show response
                hideTypingIndicator();
                updateConnectionStatus(true);
                addMessage(data.reply || 'Sorry, I didn\'t understand that.');

            } catch (error) {
                console.error('Chat error:', error);
                hideTypingIndicator();
                updateConnectionStatus(false);
                
                // Use Node.js fallback
                try {
                    const fallbackResponse = await fetch('http://localhost:3000/chat', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ message: message })
                    });
                    
                    if (fallbackResponse.ok) {
                        const fallbackData = await fallbackResponse.json();
                        addMessage(fallbackData.reply || 'Sorry, I\'m having technical difficulties.');
                    } else {
                        throw new Error('Both services unavailable');
                    }
                } catch (fallbackError) {
                    console.error('Fallback error:', fallbackError);
                    addMessage('I\'m having trouble connecting to my services. Please try again in a moment, or ask me basic questions about placements and companies.', false, true);
                }
            } finally {
                isTyping = false;
                sendBtn.disabled = false;
                input.focus();
            }
        }

        async function loadChatHistory() {
            try {
                const response = await fetch('/history');
                if (response.ok) {
                    const history = await response.json();
                    const messagesDiv = document.getElementById('chatbot-messages');
                    messagesDiv.innerHTML = '';

                    if (history.length === 0) {
                        addWelcomeMessage();
                    } else {
                        // Load existing conversation
                        history.forEach(item => {
                            addMessage(item.user, true);
                            addMessage(item.bot);
                        });
                    }
                    updateConnectionStatus(true);
                } else {
                    throw new Error('History not available');
                }
            } catch (error) {
                console.warn('Chat history not available:', error);
                addWelcomeMessage();
                updateConnectionStatus(false);
            }
        }

        function addWelcomeMessage() {
            const messagesDiv = document.getElementById('chatbot-messages');
            messagesDiv.innerHTML = '';
            addMessage('Hello! I\'m your PlaceGrad assistant. I can help you with:\n\n‚Ä¢ Company information (Synoptek, OpenXcell, eInfochips, etc.)\n‚Ä¢ Interview preparation tips\n‚Ä¢ Resume guidance\n‚Ä¢ Placement process information\n‚Ä¢ Technical preparation\n\nWhat would you like to know?');
        }

        async function clearChat() {
            try {
                await fetch('/clear', { method: 'POST' });
                document.getElementById('chatbot-messages').innerHTML = '';
                addMessage('Chat history cleared. How can I help you?');
            } catch (error) {
                console.error('Error clearing chat:', error);
                document.getElementById('chatbot-messages').innerHTML = '';
                addMessage('Chat cleared locally. How can I help you?');
            }
        }

        async function checkSystemHealth() {
            try {
                const response = await fetch('/health');
                if (response.ok) {
                    updateConnectionStatus(true);
                } else {
                    updateConnectionStatus(false);
                }
            } catch (error) {
                updateConnectionStatus(false);
            }
        }

        function askQuickQuestion(question) {
            const input = document.getElementById('user-input');
            input.value = question;
            sendMessage();
        }

        // Auto-resize textarea
        document.getElementById('user-input').addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = Math.min(this.scrollHeight, 100) + 'px';
        });

        // Enter to send (Shift+Enter for new line)
        document.getElementById('user-input').addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('PlaceGrad chatbot initialized with enhanced features');
        });
    </script>
</body>
</html>